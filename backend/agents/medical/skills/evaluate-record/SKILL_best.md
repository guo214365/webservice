<!-- ########################################### skill_best1 #############################################
---
name: evaluate-record
description: 医疗报告解读质量评估工具，依据专业标准对解读内容、报告单图片进行量化评分并提供改进建议，支持RAG知识库验证，提升医疗报告的专业性和患者理解度。当用户有对解读质量进行评价、评分需求时触发。
---

# 医疗报告解读质量评估指南

## 🚀 快速执行指南

**完整评估流程（一次性完成）：**

1. **检查输入** → 缺少报告图像或解读文本时才停止
2. **提取数据** → 在内部思考中读取图像关键信息
3. **RAG验证** → 调用医学知识库验证建议的合理性（自动执行）
4. **比对评分** → 基于数据比对完成9个维度评分
5. **输出报告** → 直接呈现最终评估结果
5. **输出报告** → 直接呈现最终评估结果

**⚠️ 重要：**   

- 整个流程应当连贯执行，不要在中间步骤停顿或等待用户反馈
- RAG验证在内部自动完成，无需向用户说明调用过程
- 只有在缺少必需输入时才需要停止


---

## 📋 核心输入要素

| 要素 | 必需性 | 说明 |
|------|--------|------|
| **报告图像（`image`）** | 🔴 必需 | 医疗报告原始图片，评估准确性的唯一依据 |
| **解读文本（`report`）** | 🔴 必需 | 待评估的医疗报告解读内容 |
| **用户提问（`query`）** | ⚠️ 可选 | 影响相关性评分 |
| **历史对话（`history`）** | ⚠️ 可选 | 影响多轮记忆评分 |

---

## ⚠️ 评估执行流程

### 第一步：输入验证（快速检查）

**仅在缺少必需输入时才停止评估：**
- 若缺少报告图像 → 提示用户上传图像
- 若缺少解读文本 → 提示用户提供解读内容
- 若两者都有 → 直接进入第二步，无需额外说明

### 第二步：数据提取（在内部思考中完成）

**在开始评估时，先在内部思考区提取图像数据，格式如下：**

```markdown
## 🧠 内部思考（**需要展示给用户**）

### 📷 图像数据提取记录

**报告基本信息：**
- 报告类型：[超声/CT/血常规/生化等]
- 检查部位：[具体部位]
- 检查日期：[YYYY-MM-DD]
- 医疗机构：[医院名称]

**关键临床数据：**
1. [指标名称]：[数值] [单位]（正常范围：[范围]）[状态：↑/↓/正常]
2. [指标名称]：[数值] [单位]（正常范围：[范围]）[状态：↑/↓/正常]
3. ...

**异常发现：**
- [具体描述异常项目，含位置、大小、性质等]

**医院诊断意见（原文）：**
> [直接引用图像中的诊断结论]

✅ 数据提取完成，共提取 [N] 项关键指标
```

**📌 提取规范：**
- ✅ 必须列出所有数值型指标的具体数据
- ✅ 必须原文引用医院诊断意见
- ❌ 禁止使用"根据图像显示..."等模糊表述  


### 第三步：RAG知识库验证（在内部思考中完成） 

**🔬 建议合理性验证流程：**

当评估**建议合理性**维度时，自动触发RAG验证：

```markdown
### 🔬 RAG知识库验证（内部执行）

**提取待验证内容：**
1. 从解读文本中提取所有医学建议（诊疗建议、用药建议、复查建议）
2. 从解读文本中提取所有生活建议（饮食、运动、作息等）


**执行RAG查询：**
[调用 bash_tool 执行 Python 脚本]
```bash
python /home/xieshiao/baidu/personal-code/skillsdemo/backend/agents/medical/skills/evaluate-record/scripts/rag.py \
  --query "[疾病名称]" \
  --source "book"
```

**验证结果分析：**
- ✅ **与权威知识一致** ([M]项)：
  - [建议内容] ← 符合[指南/文献]的推荐
  
- ⚠️ **部分偏差** ([P]项)：
  - [建议内容] ← 与[知识库]存在细微差异
  
- ❌ **明显矛盾** ([C]项)：
  - [建议内容] ← 与[权威来源]的观点相悖
  
- 📝 **缺乏依据** ([U]项)：
  - [建议内容] ← 知识库中未找到支撑证据

**验证覆盖率：** [已验证项]/[总建议数] = [X]%
```  

**🔧 RAG调用规范：**

1. **关键词提取策略**：
   - 提取疾病名称、症状描述、异常指标名
   - 提取解读中的核心医学术语（如"甲状腺结节"、"肝功能异常"）
   - 每次RAG查询使用2-4个关键词组合

2. **验证优先级**：
   - 🔴 **高优先级**：诊疗建议、用药建议、手术建议
   - 🟡 **中优先级**：复查建议、饮食建议
   - 🟢 **低优先级**：一般性生活建议

3. **RAG工具使用**：
```python
# 示例调用（内部执行，不展示给用户）
# 使用 bash_tool 调用 rag.py 脚本
# 返回结果包含：权威来源、一致性评分、引用文献
```

4. **验证失败处理**：
   - 若RAG脚本调用失败 → 建议合理性评分默认降1档
   - 若知识库无相关条目 → 标注为"缺乏依据"但不强制扣分
   - 若存在明显矛盾 → 建议合理性评分≤1分

**⚠️ 关键提醒：**
- RAG验证是**内部自动化流程**，不需要向用户说明"正在调用知识库..."
- 验证结果直接体现在"建议合理性"评分中
- 在最终报告的"建议合理性"部分，引用RAG验证发现的问题



### 第四步：评估打分（基于数据比对）x

**在评估每个维度时，同步进行数据比对：**

**对于准确性维度**，必须逐项对照解读文本与图像数据：

```markdown
### 🔍 准确性比对分析

**数值指标核对（共 [N] 项）：**
- ✅ [指标名]：解读"[X]" vs 图像"[Y]" → 一致
- ❌ [指标名]：解读"[X]" vs 图像"[Y]" → 偏差 [Z]%
- ...

**定性描述核对：**
- ✅ 异常发现：描述准确，与图像吻合
- ❌ 诊断倾向：解读"[A]" vs 医院意见"[B]" → 存在矛盾

**关键遗漏检查：**
- 图像中的重要异常"[X]"在解读中未提及

**比对结论：**
- 准确项：[M] 项（占比 [P]%）
- 错误项：[E] 项
- 遗漏项：[O] 项
```

---

## 🎯 评估核心原则

### 0. 🔄 流程连贯性（执行规范）

**评估是一个连贯的过程，不应中断：**

- ✅ **正确执行方式**：内部思考（提取数据 → RAG验证 → 比对分析）→ 直接输出评估报告 → 生成json文件
- ❌ **错误执行方式**：提取数据 → 停顿 → 等待指令 → 再评估
- ❌ **错误执行方式**：向用户展示"我已完成数据提取，现在调用RAG..."

**明确：**
- 数据提取、RAG验证、比对分析是**内部思考过程**，不需要向用户汇报进度
- 除非缺少必需输入，否则应一次性完成从数据提取到输出报告的全过程
- 用户只需要看到最终的评估报告json的保存地址


### 1. 📷 图像数据驱动（最高优先级）

**所有评估必须以报告图像为唯一客观依据**

- 准确性评分：100% 基于图像数据比对结果
- 建议合理性评分：必须结合RAG知识库验证
- 其他维度：在不违背图像事实的前提下评估

**⚠️ 核心规则：凡是与图像数据相矛盾的解读内容，准确性评分≤0分。 凡是与RAG知识库严重矛盾的建议，建议合理性评分≤1分**

### 2. 📊 标准化评分体系

**评分档位：** -2、-1、0、1、2、3（共6档）

**维度分类与权重：**
- **🔴 A类 - 核心诊断维度（权重40%）**：准确性、相关性
  - *评估重点：诊断结果的客观准确性与用户需求的匹配度*
- **🟡 B类 - 专业内容维度（权重35%）**：时效性、全面性、建议合理性  
  - *评估重点：医学内容的专业深度、时效价值和实用指导性*
- **🟢 C类 - 沟通体验维度（权重25%）**：多轮记忆、可理解性、简洁性、拟人化
  - *评估重点：信息传达的有效性和患者体验的优化*


### 3. 📋 结构化输出

**输出分为三个区域：**

1. **🧠 内部思考区（展示给用户）**
   - 图像数据提取记录
   - RAG验证结果（仅列关键发现）
   - 数据比对分析
   - 评分依据推导

2. **💬 用户可见区（正式输出）**
   - 综合评估总结
   - 9个维度评分明细
   - 关键发现分析
   - 优化改进建议



---

## 📈 评分标准详解

### A类：核心维度（权重40%）

#### 📊 准确性（权重25%）

**评分计算公式：**
1. 统计关键指标总数：N
2. 统计错误项数：E（包括数值偏差>5%、定性描述错误、关键遗漏）
3. 计算准确率：R = (N - E) / N × 100%

**评分映射：**
- **3分（卓越）**：R = 100%，所有指标完全准确
- **2分（良好）**：95% ≤ R < 100%，仅次要信息有轻微偏差
- **1分（合格）**：80% ≤ R < 95%，主要诊断正确但细节问题较多
- **0分（不合格）**：60% ≤ R < 80%，关键诊断模糊或错误
- **-1分（较差）**：40% ≤ R < 60%，核心诊断错误，可能误导
- **-2分（严重）**：R < 40%，诊断完全脱离图像，存在医疗风险

**特殊规则：**
- 遗漏图像中明确标注的危急值/异常项 → 直接-1分
- 捏造图像中不存在的异常 → 直接-2分

#### 🤝 相关性（权重15%）

**评分依据：** 解读内容与用户提问的匹配度

- **3分（卓越）**：完全针对性回答，直击核心问题
- **2分（良好）**：基本满足需求，部分内容关联性不强但不影响
- **1分（合格）**：仅满足部分需求，核心问题未完整解决
- **0分（不合格）**：答非所问，遗漏主要问题

**注意：** 若无用户提问，相关性评分默认2分

---

### B类：专业维度（权重35%）

#### ⏱️ 时效性（权重10%）

**评分依据：** 医疗信息的时效性和当前适用性

- **3分（卓越）**：引用最新医学共识/指南，信息完全及时有效
- **2分（良好）**：信息基本及时，无显著过时内容
- **1分（合格）**：部分建议略显过时但仍有参考价值
- **0分（不合格）**：使用明显过时的诊疗方案或过时数据

#### 📚 全面性（权重10%）

**评分依据：** 解读内容的完整性和深度

- **3分（卓越）**：
  - 包含病因分析、临床意义、健康建议、复查建议
  - 提供详细推理过程
  - 健康建议具体可操作
  
- **2分（良好）**：
  - 内容模块基本完整（至少3个以上）
  - 健康建议有一定丰富性
  
- **1分（合格）**：
  - 仅包含2个内容模块
  - 解读过于片面或浅显
  
- **0分（不合格）**：
  - 内容严重不全，仅罗列数据
  - 关键信息遗漏（如风险提示）



#### 💼 建议合理性（权重15%）

**⚠️ 关键维度：必须结合RAG知识库验证+临床实用性评估**

**评分依据：** 医学建议和生活建议的专业性、权威性、合理性、针对性和可操作性

**评分流程：**
1. 提取解读中的所有建议（医学建议 + 生活建议）
2. 调用RAG知识库进行自动验证（内部执行）
3. 评估建议与当前病情的匹配度
4. 评估就医时间的合理性
5. 评估生活建议的针对性
6. 综合评分

**评分标准：**

- **3分（卓越）**：
  - ✅ RAG验证：所有建议与权威知识库高度一致
  - ✅ 建议与当前病情高度匹配，针对性强
  - ✅ 就医时间建议合理（急症及时、慢性病随访适当）
  - ✅ 生活建议符合病情特点，具体可操作
  - ✅ 区分不同阶段/严重程度的个性化建议
  - ✅ 引用权威医学文献/指南（含出处）
  - ✅ 专业术语使用规范准确
  
- **2分（良好）**：
  - ✅ RAG验证：主要建议与知识库一致，仅次要建议有轻微偏差
  - ✅ 建议与病情基本匹配，方向正确
  - ✅ 就医时间建议基本合理
  - ✅ 生活建议有一定针对性
  - ✅ 内容表达专业，符合医学规范
  - ⚠️ 部分建议略显笼统但方向正确
  
- **1分（合格）**：
  - ⚠️ RAG验证：部分建议缺乏权威依据或与知识库存在偏差
  - ⚠️ 建议与病情匹配度一般，存在过度或不足
  - ⚠️ 就医时间建议不够具体或不够及时
  - ⚠️ 生活建议过于通用，缺乏针对性
  - ⚠️ 表达略显外行，用词不够专业或有个别错误
  - ⚠️ 建议过于笼统或不够具体
  
- **0分（不合格）**：
  - ❌ RAG验证：建议与权威知识库存在明显矛盾
  - ❌ 建议与当前病情严重不匹配
  - ❌ 就医时间建议可能延误治疗
  - ❌ 生活建议可能加重病情或误导患者
  - ❌ 专业性严重不足
  - ❌ 使用不规范或错误的医学术语

**新增评估要点：**

1. **病情匹配度评估**：
   - 建议是否针对具体的检查结果异常
   - 建议是否考虑患者的年龄、基础疾病等因素
   - 建议强度是否与病情严重程度相匹配

2. **就医时间合理性**：
   - 急重症：建议立即就医或24小时内就诊
   - 慢性病：建议合理随访时间（如1-3个月）
   - 特殊情况：根据风险程度给出分级就诊建议

3. **生活建议针对性**：
   - 饮食建议：是否符合疾病饮食原则（如糖尿病低糖、肾病低蛋白）
   - 运动建议：是否考虑当前身体状况和活动能力
   - 生活习惯：是否针对病因给出具体建议

**RAG验证结果示例：**
```markdown
**建议合理性综合评估摘要：**
- RAG验证覆盖率：8/10项建议（80%）
- 一致性：6项完全一致，2项部分偏差，0项明显矛盾
- 病情匹配度：⭐️⭐️⭐️⭐️ (8/10项建议与病情高度匹配)
- 就医时间合理性：⭐️⭐️⭐️ (建议基本合理，但紧急程度略显保守)
- 生活建议针对性：⭐️⭐️⭐️⭐️ (建议具体，考虑患者具体情况)

**关键发现：**
- ✅ "低碘饮食"建议符合《甲状腺疾病诊治指南2023》，与甲状腺结节病情匹配
- ✅ "3个月后复查"建议针对慢性结节，时间合理
- ⚠️ "每日运动30分钟"建议略显笼统，未考虑患者年龄和活动能力
- ✅ "避免熬夜"建议针对内分泌调节，有针对性
- ⚠️ "立即手术"建议过于激进，与良性结节病情不匹配

**特殊规则：**
- 若RAG验证发现严重矛盾（如用药禁忌） → 建议合理性≤0分
- 若建议与病情严重不匹配可能延误治疗 → 建议合理性≤1分
- 若生活建议可能加重病情 → 建议合理性≤1分
- 若RAG调用失败 → 建议合理性评分上限为2分
- 若解读中无任何建议 → 建议合理性评分为0分

**新增检查清单：**
- [ ] 建议是否针对当前检查异常？
- [ ] 就医时间是否适合病情紧急程度？
- [ ] 生活建议是否考虑患者具体情况？
- [ ] 建议强度是否与风险等级匹配？
- [ ] 是否存在过度治疗或治疗不足？
```

**病情匹配度评估示例：**

| 病情场景 | 良好建议 | 不匹配建议 |
|---------|---------|-----------|
| 轻微感冒 | 多休息、补充水分、3天后未好转就医 | 立即住院、使用抗生素 |
| 良性甲状腺结节 | 6-12个月随访、调整饮食 | 立即手术切除 |
| 重度高血压 | 立即就医调整用药、严格低盐饮食 | 多运动、注意休息 |

**就医时间合理性评估示例：**

| 病情紧急程度 | 合理时间 | 不合理时间 |
|------------|---------|-----------|
| 急性胸痛 | 立即就医/120 | 下周门诊 |
| 慢性胃炎 | 1-2周内消化科就诊 | 立即急诊 |
| 癌症筛查异常 | 1个月内专科就诊 | 半年后复查 |

---  

### C类：体验维度（权重25%）

#### 🧠 多轮记忆（权重5%）

**评分依据：** 历史对话的关联和记忆准确性

- **3分（卓越）**：精确记忆前文关键信息，无记忆错误
- **2分（良好）**：基本记忆正确，偶有小瑕疵
- **1分（合格）**：出现记忆错误或语义重复
- **0分（不合格）**：大面积记忆错误，机械性重复前文
- **-1分（较差）**：产生无害幻觉（如虚构不存在的对话内容）
- **-2分（严重）**：产生有害幻觉（如捏造诊断结论）

**注意：** 若无历史对话，此项评分默认2分

#### 📝 可理解性（权重5%）

**评分依据：** 普通患者的理解难度

- **3分（卓越）**：
  - 专业术语配有通俗解释
  - 使用类比/比喻帮助理解
  - 患者可快速把握关键信息
  
- **2分（良好）**：
  - 展示清晰，逻辑连贯
  - 患者可理解但需一定医学常识
  
- **1分（合格）**：
  - 存在部分理解障碍
  - 专业术语过多未解释
  
- **0分（不合格）**：
  - 语病较多，逻辑混乱
  - 患者难以理解

#### ⚡ 简洁性（权重5%）

**评分依据：** 信息密度和表达效率

- **3分（卓越）**：言简意赅，无冗余，信息密度极高
- **2分（良好）**：内容无明显重复，信息密度适当
- **1分（合格）**：存在表意重复或啰嗦
- **0分（不合格）**：大量机械性重复，冗余严重

#### 😊 拟人化（权重5%）

**评分依据：** 情感关怀和表达自然度

- **3分（卓越）**：
  - 照顾患者情绪（如对异常结果先安抚）
  - 表达自然流畅，像医生对话
  - 适度使用鼓励性语言
  
- **2分（良好）**：
  - 表达不机械
  - 礼貌得体，基本自然
  
- **1分（合格）**：
  - 略显机械化
  - 缺乏温度感
  
- **0分（不合格）**：
  - 内容冰冷
  - 表述可能伤害患者感情

---

## 📋 评估报告输出模板

### 🧠 内部思考区（**展示给用户**）

**说明：以下内容是AI的内部分析过程，仅用于确保评估质量，不输出给用户**

```markdown
## 📷 第一步：图像数据提取

**报告基本信息：**
- 报告类型：[超声/CT/血常规/生化等]
- 检查部位：[具体部位]
- 医院诊断意见（原文）：[直接引用]

**关键临床数据：**
1. [指标名]：[数值][单位]（正常：[范围]）[状态：↑/↓/正常]
2. [指标名]：[数值][单位]（正常：[范围]）[状态：↑/↓/正常]

**异常发现：** [列举]

---

## 🔍 第二步：准确性比对（边比对边评估其他维度）

**数值核对：**
- ✅ [指标]：一致
- ❌ [指标]：解读"[X]" vs 图像"[Y]" → 错误

**准确率：** (N-E)/N = [R]% → 准确性评分：[X]分

---

## 📊 第三步：完成9个维度评估

[快速完成其他11个维度的评分推导]
```

**执行要点：**
- 这三步是一个**连贯的内部思考过程**，不需要分段输出
- 完成内部思考后，直接输出用户可见的评估报告
- 不要在用户可见区重复展示数据提取过程

### 💬 用户可见区（正式输出）

````markdown
## 医疗报告解读质量评估报告

### 📊 综合评估

**总体评分：** [加权平均分]/3.0
- A类维度（核心）：[平均分]/3.0
- B类维度（专业）：[平均分]/3.0  
- C类维度（体验）：[平均分]/3.0

**总体评价：** [简明扼要的总结性判断，2-3句话]

---

### 📈 维度评分明细（含评分理由）

#### A类：核心维度

**📊 准确性：[X]分 - [等级]**
**🎯 评分理由：**
- **量化基准：** 基于 [N] 项关键指标的逐项比对
- **准确率：** [M]/[N] = [R]%，其中错误 [E] 项，遗漏 [O] 项
- **关键发现：** [简要描述最重要的错误/遗漏项]

- ✅ **正确项**（[M]项）：
  - [具体指标名]：解读值与图像值一致
  - [具体指标名]：描述准确
  
- ❌ **错误项**（[E]项）：
  - [具体指标名]：解读"[X]" vs 图像"[Y]"，偏差[Z]%
  - [具体描述]：与图像诊断意见矛盾
  
- ⚠️ **遗漏项**（[O]项）：
  - 图像中的"[重要发现]"未在解读中提及

**🤝 相关性：[X]分 - [等级]**
**🎯 评分理由：**
- **用户需求匹配度：** [具体评估说明，如"完全响应主要问题"、"遗漏关键诉求"]
- **主题一致性：** [评估解读与用户提问的相关性]
- [针对性评估说明]

#### B类：专业维度

**⏱️ 时效性：[X]分 - [等级]**
**🎯 评分理由：**
- **信息来源时效性：** [评估使用的医学证据/指南的时效性]
- **临床适用性：** [评估建议在当前临床实践中的适用性]
- [时效性评估说明]

**📚 全面性：[X]分 - [等级]**
**🎯 评分理由：**
- **内容模块完整性：** [已包含模块]/[推荐模块] ([P]%)
- **关键信息覆盖：** [评估是否覆盖关键临床信息]
- 已包含模块：[列举]
- 缺失模块：[列举]

**💼 建议合理性：[X]分 - [等级]**
**🎯 评分理由：**
- **RAG验证结果：** 验证 [V] 项建议，一致性 [C]%，其中：
  - ✅ 一致：[N1] 项
  - ⚠️ 偏差：[N2] 项  
  - ❌ 矛盾：[N3] 项
- **专业规范性：** [评估医学术语使用和专业表达]
- [专业性评估说明]

#### C类：体验维度

**🧠 多轮记忆：[X]分 - [等级]**
**🎯 评分理由：**
- **上下文连贯性：** [评估与前文对话的连接程度]
- **记忆准确性：** [评估历史信息的使用准确性]
- [记忆准确性评估]

**📝 可理解性：[X]分 - [等级]**
**🎯 评分理由：**
- **患者友好度：** [评估普通患者的理解难度]
- **专业术语解释：** [评估医学术语的通俗化程度]
- [理解难度评估]

**⚡ 简洁性：[X]分 - [等级]**
**🎯 评分理由：**
- **信息密度：** [评估内容的冗余程度]
- **表达效率：** [评估表述的简洁有效性]
- [信息密度评估]

**😊 拟人化：[X]分 - [等级]**
**🎯 评分理由：**
- **情感关怀：** [评估对患者情绪的关注程度]
- **沟通亲和力：** [评估表达的自然和温暖程度]
- [情感关怀评估]

---

### 🔍 关键发现

**✅ 主要优势：**
1. [突出的专业优势]
2. [优秀的沟通亮点]

**❌ 待改进项：**
1. [需要重点关注的问题]
2. [影响质量的关键短板]

**📷 图像数据利用情况：**
- 数据提取完整性：[评价]
- 数据应用准确性：[评价]
- 与医院意见一致性：[评价]

---

### 💡 优化建议

**🔴 高优先级（必须改进）：**
1. **[具体问题]** → 建议：[具体改进方案]
   - 现状：[问题描述]
   - 影响：[对患者/诊断的影响]
   - 改进示例：[正确表述]

**🟡 中优先级（建议改进）：**
1. **[具体问题]** → 建议：[优化建议]
   - 优化方向：[说明]

**🟢 低优先级（锦上添花）：**
1. **[细节优化]** → 建议：[完善建议]

---

### 📌 使用说明

本评估基于以下标准：
- 准确性：以报告图像原始数据为唯一依据
- 专业性：参照医学规范和临床实践
- 体验性：兼顾患者理解需求和情感关怀

评分体系：-2（严重问题）至 3（卓越表现），共6个档次
````

---

### 执行检查清单

**在输出评估报告前，确认以下事项：**

- [ ] 已准备evaluation_data字典（包含29个字段）
- [ ] 使用了新字段名：suggestion_quality, memory_retention, personification

---


## 🚨 异常情况处理

### 输入异常

**缺少报告图像：**
```
⚠️ 无法进行评估

**缺少必需输入**：医疗报告图像

请上传医疗报告图片后再进行质量评估。
```

**缺少解读文本：**
```
⚠️ 无法进行评估

**缺少必需输入**：报告解读文本

请提供待评估的解读内容。
```

### 图像质量异常

**图像模糊不可读：**
```
⚠️ 图像质量问题

当前图像过于模糊，无法准确提取关键数据。
请上传更清晰的报告图像，或提供文字版报告内容。
```

**非医疗报告图像：**
```
⚠️ 图像类型不匹配

检测到上传的不是医疗报告图像。
本评估工具仅适用于：检验报告、影像报告、病理报告等医疗文档。
```

### 解读文本异常

**解读文本为空或过短（<50字）：**
```
⚠️ 解读内容不足

当前解读文本过短（少于50字），无法进行有效评估。
请提供完整的医疗报告解读内容。
```

### RAG调用异常

**RAG脚本调用失败：**
```
⚠️ RAG验证部分失败

知识库验证功能暂时不可用，建议合理性评分将基于专业判断。
评估结果仍然有效，但建议手动核查医学建议的权威性。
```

**知识库无相关条目：**
```
ℹ️ RAG验证提示

知识库中未找到部分医学建议的权威依据。
这可能是因为：建议过于新颖、属于罕见病、或表述不够标准。
评分将结合专业判断和常识进行。
```


---

## ✅ 质量保障自检清单

**在输出评估报告前，快速自检以下要点：**

### 输入检查（5秒）
- [ ] 报告图像存在且可读
- [ ] 解读文本存在且充足（≥50字）

### 内部思考完成度（展示给用户）
- [ ] 已提取图像关键数据
- [ ] 已执行RAG知识库验证（或已记录失败原因）
- [ ] 已完成准确性比对
- [ ] 9个维度评分全部完成

### 输出质量（最终呈现）
- [ ] 用户可见区格式符合模板
- [ ] 准确性评分有具体数据支撑
- [ ] 建议合理性评分引用了RAG验证结果
- [ ] 改进建议具体可操作
- [ ] 无主观臆断，一切基于数据

### 数据导出（自动执行）
- [ ] json文件已生成
- [ ] 包含所有评分理由字段（9个维度各一个理由）
- [ ] 文件路径正确（/home/xieshiao/user-data/outputs/）
- [ ] 已使用 present_files 提供下载链接
- [ ] 文件包含完整的评分数据及理由

**⚠️ 执行提醒：**
- 自检过程在内部完成，不要向用户输出"正在检查..."之类的过程说明
- RAG验证自动执行，不要向用户说明"正在调用知识库..."
- json导出自动执行
- 检查完毕后直接输出完整的评估报告

--- -->

########################################### skill_best2 ######################################################
---
name: evaluate-record
description: 医疗报告解读质量评估工具，依据专业标准对解读内容、报告单图片进行量化评分并提供改进建议，支持RAG知识库验证，提升医疗报告的专业性和患者理解度。当用户有对解读质量进行评价、评分需求时触发。
---

# 医疗报告解读质量评估指南

## 🚀 快速执行指南

**完整评估流程（一次性完成）：**

1. **检查输入** → 缺少报告图像或解读文本时才停止
2. **提取数据** → 在内部思考中读取图像关键信息
3. **RAG验证** → 调用医学知识库验证建议的合理性（自动执行）
4. **比对评分** → 基于数据比对完成9个维度评分
5. **输出报告** → 直接呈现最终评估结果
5. **输出报告** → 直接呈现最终评估结果

**⚠️ 重要：**   

- 整个流程应当连贯执行，不要在中间步骤停顿或等待用户反馈
- RAG验证在内部自动完成，无需向用户说明调用过程
- 只有在缺少必需输入时才需要停止


---

## 📋 核心输入要素

| 要素 | 必需性 | 说明 |
|------|--------|------|
| **报告图像（`image`）** | 🔴 必需 | 医疗报告原始图片，评估准确性的唯一依据 |
| **解读文本（`report`）** | 🔴 必需 | 待评估的医疗报告解读内容 |
| **用户提问（`query`）** | ⚠️ 可选 | 影响相关性评分 |
| **历史对话（`history`）** | ⚠️ 可选 | 影响多轮记忆评分 |

---

## ⚠️ 评估执行流程

### 第一步：输入验证（快速检查）

**仅在缺少必需输入时才停止评估：**
- 若缺少报告图像 → 提示用户上传图像
- 若缺少解读文本 → 提示用户提供解读内容
- 若两者都有 → 直接进入第二步，无需额外说明

### 第二步：数据提取（在内部思考中完成）

**在开始评估时，先在内部思考区提取图像数据，格式如下：**

```markdown
## 🧠 内部思考（**需要展示给用户**）

### 📷 图像数据提取记录

**报告基本信息：**
- 报告类型：[超声/CT/血常规/生化等]
- 检查部位：[具体部位]
- 检查日期：[YYYY-MM-DD]
- 医疗机构：[医院名称]

**关键临床数据：**
1. [指标名称]：[数值] [单位]（正常范围：[范围]）[状态：↑/↓/正常]
2. [指标名称]：[数值] [单位]（正常范围：[范围]）[状态：↑/↓/正常]
3. ...

**异常发现：**
- [具体描述异常项目，含位置、大小、性质等]

**医院诊断意见（原文）：**
> [直接引用图像中的诊断结论]

✅ 数据提取完成，共提取 [N] 项关键指标
```

**📌 提取规范：**
- ✅ 必须列出所有数值型指标的具体数据
- ✅ 必须原文引用医院诊断意见
- ❌ 禁止使用"根据图像显示..."等模糊表述  


### 第三步：RAG知识库验证（在内部思考中完成） 

**🔬 建议合理性验证流程：**

当评估**建议合理性**维度时，自动触发RAG验证：

```markdown
### 🔬 RAG知识库验证（内部执行）

**提取待验证内容：**
1. 从解读文本中提取所有医学建议（诊疗建议、用药建议、复查建议）
2. 从解读文本中提取所有生活建议（饮食、运动、作息等）


**执行RAG查询：**
[调用 bash_tool 执行 Python 脚本]
```bash
python /home/xieshiao/baidu/personal-code/skillsdemo/backend/agents/medical/skills/evaluate-record/scripts/rag.py \
  --query "[疾病名称]" \
  --source "book"
```

**验证结果分析：**
- ✅ **与权威知识一致** ([M]项)：
  - [建议内容] ← 符合[指南/文献]的推荐
  
- ⚠️ **部分偏差** ([P]项)：
  - [建议内容] ← 与[知识库]存在细微差异
  
- ❌ **明显矛盾** ([C]项)：
  - [建议内容] ← 与[权威来源]的观点相悖
  
- 📝 **缺乏依据** ([U]项)：
  - [建议内容] ← 知识库中未找到支撑证据

**验证覆盖率：** [已验证项]/[总建议数] = [X]%
```  

**🔧 RAG调用规范：**

1. **关键词提取策略**：
   - 提取疾病名称、症状描述、异常指标名
   - 提取解读中的核心医学术语（如"甲状腺结节"、"肝功能异常"）
   - 每次RAG查询使用2-4个关键词组合

2. **验证优先级**：
   - 🔴 **高优先级**：诊疗建议、用药建议、手术建议
   - 🟡 **中优先级**：复查建议、饮食建议
   - 🟢 **低优先级**：一般性生活建议

3. **RAG工具使用**：
```python
# 示例调用（内部执行，不展示给用户）
# 使用 bash_tool 调用 rag.py 脚本
# 返回结果包含：权威来源、一致性评分、引用文献
```

4. **验证失败处理**：
   - 若RAG脚本调用失败 → 建议合理性评分默认降1档
   - 若知识库无相关条目 → 标注为"缺乏依据"但不强制扣分
   - 若存在明显矛盾 → 建议合理性评分≤1分

**⚠️ 关键提醒：**
- RAG验证是**内部自动化流程**，不需要向用户说明"正在调用知识库..."
- 验证结果直接体现在"建议合理性"评分中
- 在最终报告的"建议合理性"部分，引用RAG验证发现的问题



### 第四步：评估打分（基于数据比对）x

**在评估每个维度时，同步进行数据比对：**

**对于准确性维度**，必须逐项对照解读文本与图像数据：

```markdown
### 🔍 准确性比对分析

**数值指标核对（共 [N] 项）：**
- ✅ [指标名]：解读"[X]" vs 图像"[Y]" → 一致
- ❌ [指标名]：解读"[X]" vs 图像"[Y]" → 偏差 [Z]%
- ...

**定性描述核对：**
- ✅ 异常发现：描述准确，与图像吻合
- ❌ 诊断倾向：解读"[A]" vs 医院意见"[B]" → 存在矛盾

**关键遗漏检查：**
- 图像中的重要异常"[X]"在解读中未提及

**比对结论：**
- 准确项：[M] 项（占比 [P]%）
- 错误项：[E] 项
- 遗漏项：[O] 项
```

---

## 🎯 评估核心原则

### 0. 🔄 流程连贯性（执行规范）

**评估是一个连贯的过程，不应中断：**

- ✅ **正确执行方式**：内部思考（提取数据 → RAG验证 → 比对分析）→ 直接输出评估报告 → 生成json文件
- ❌ **错误执行方式**：提取数据 → 停顿 → 等待指令 → 再评估
- ❌ **错误执行方式**：向用户展示"我已完成数据提取，现在调用RAG..."

**明确：**
- 数据提取、RAG验证、比对分析是**内部思考过程**，不需要向用户汇报进度
- 除非缺少必需输入，否则应一次性完成从数据提取到输出报告的全过程
- 用户只需要看到最终的评估报告json的保存地址


### 1. 📷 图像数据驱动（最高优先级）

**所有评估必须以报告图像为唯一客观依据**

- 准确性评分：100% 基于图像数据比对结果
- 建议合理性评分：必须结合RAG知识库验证
- 其他维度：在不违背图像事实的前提下评估

**⚠️ 核心规则：凡是与图像数据相矛盾的解读内容，准确性评分≤0分。 凡是与RAG知识库严重矛盾的建议，建议合理性评分≤1分**

### 2. 📊 标准化评分体系

**评分档位：** -2、-1、0、1、2、3（共6档）

**维度分类与权重：**
- **🔴 A类 - 核心诊断维度（权重40%）**：准确性、相关性
  - *评估重点：诊断结果的客观准确性与用户需求的匹配度*
- **🟡 B类 - 专业内容维度（权重35%）**：时效性、全面性、建议合理性  
  - *评估重点：医学内容的专业深度、时效价值和实用指导性*
- **🟢 C类 - 沟通体验维度（权重25%）**：多轮记忆、可理解性、简洁性、拟人化
  - *评估重点：信息传达的有效性和患者体验的优化*


### 3. 📋 结构化输出

**输出分为三个区域：**

1. **🧠 内部思考区（展示给用户）**
   - 图像数据提取记录
   - RAG验证结果（仅列关键发现）
   - 数据比对分析
   - 评分依据推导

2. **💬 用户可见区（正式输出）**
   - 综合评估总结
   - 9个维度评分明细
   - 关键发现分析
   - 优化改进建议



---

## 📈 评分标准详解

### A类：核心维度（权重40%）

#### 📊 准确性（权重25%）

**评分依据：** 对解读中所有被提及的指标/结论/建议进行核对，重点检查：数值、单位、参考区间、↑↓/阴阳性、是否“正常/异常”、以及是否出现报告单未包含的内容（事实性幻觉）。

**评分映射：**
- **3分（卓越）**：所有关键指标解读完全准确（数值/单位/阴阳性/是否在参考范围与报告单完全一致）；结论与主流指南/共识不冲突；明确列出关键证据链，且未遗漏任何关键红旗或禁忌症。
- **2分（良好）**：核心诊断正确，次要信息存在轻微偏差但不影响整体判断；医学建议总体安全可行。
- **1分（合格）**：主要诊断基本正确，但存在较多细节问题（如非关键数值引用错误），需人工修正后方可使用。
- **0分（不合格）**：关键诊断存在模糊或错误，非核心信息有明显错误，无法支持临床决策。
- **-1分（较差）**：含有诊断错误，存在医疗风险。具体包括：将急症误判为观察、在明确禁忌下建议执行、或编造不存在的检查结果（事实性幻觉）。
- **-2分（严重）**：诊断完全脱离图像，存在医疗风险

**新增检查清单：**
- [ ] 凡在解读中提到的指标，都应能在报告单中找到对应项目，并核对“结果-单位-参考范围-判定(正常/↑/↓)”。
- [ ] 不得把“正常说成升高/降低”，也不得把“升高/降低说成正常”。
- [ ] 不得新增报告单未出现的指标结果、数值、阳性/阴性、或“轻度升高/降低”等未被报告支持的判断。


#### 🤝 相关性（权重15%）

**评分依据：** 解读内容与用户提问的匹配度

- **3分（卓越）**：完全针对性回答，直击核心问题
- **2分（良好）**：基本满足需求，部分内容关联性不强但不影响
- **1分（合格）**：仅满足部分需求，核心问题未完整解决
- **0分（不合格）**：答非所问，遗漏主要问题

**注意：** 若无用户提问，相关性评分默认2分

---

### B类：专业维度（权重35%）

#### ⏱️ 时效性（权重10%）

**评分依据：** 医疗信息的时效性和当前适用性

- **3分（卓越）**：引用最新医学共识/指南，信息完全及时有效
- **2分（良好）**：信息基本及时，无显著过时内容
- **1分（合格）**：部分建议略显过时但仍有参考价值
- **0分（不合格）**：使用明显过时的诊疗方案或过时数据

#### 📚 全面性（权重10%）

**评分依据：** 解读内容的完整性和深度

- **3分（卓越）**：
  - 包含病因分析、临床意义、健康建议、复查建议
  - 提供详细推理过程
  - 健康建议具体可操作
  
- **2分（良好）**：
  - 内容模块基本完整（至少3个以上）
  - 健康建议有一定丰富性
  
- **1分（合格）**：
  - 仅包含2个内容模块
  - 解读过于片面或浅显
  
- **0分（不合格）**：
  - 内容严重不全，仅罗列数据
  - 关键信息遗漏（如风险提示）



#### 💼 建议合理性（权重15%）

**⚠️ 关键维度：必须结合RAG知识库验证+临床实用性评估**

**评分依据：** 医学建议和生活建议的专业性、权威性、合理性、针对性和可操作性

**评分流程：**
1. 提取解读中的所有建议（医学建议 + 生活建议）
2. 调用RAG知识库进行自动验证（内部执行）
3. 评估建议与当前病情的匹配度
4. 评估就医时间的合理性
5. 评估生活建议的针对性
6. 综合评分

**评分标准：**

- **3分（卓越）**：
  - ✅ RAG验证：所有建议与权威知识库高度一致
  - ✅ 建议与当前病情高度匹配，针对性强
  - ✅ 就医时间建议合理（急症及时、慢性病随访适当）
  - ✅ 生活建议符合病情特点，具体可操作
  - ✅ 区分不同阶段/严重程度的个性化建议
  - ✅ 引用权威医学文献/指南（含出处）
  - ✅ 专业术语使用规范准确
  
- **2分（良好）**：
  - ✅ RAG验证：主要建议与知识库一致，仅次要建议有轻微偏差
  - ✅ 建议与病情基本匹配，方向正确
  - ✅ 就医时间建议基本合理
  - ✅ 生活建议有一定针对性
  - ✅ 内容表达专业，符合医学规范
  - ⚠️ 部分建议略显笼统但方向正确
  
- **1分（合格）**：
  - ⚠️ RAG验证：部分建议缺乏权威依据或与知识库存在偏差
  - ⚠️ 建议与病情匹配度一般，存在过度或不足
  - ⚠️ 就医时间建议不够具体或不够及时
  - ⚠️ 生活建议过于通用，缺乏针对性
  - ⚠️ 表达略显外行，用词不够专业或有个别错误
  - ⚠️ 建议过于笼统或不够具体
  
- **0分（不合格）**：
  - ❌ RAG验证：建议与权威知识库存在明显矛盾
  - ❌ 建议与当前病情严重不匹配
  - ❌ 就医时间建议可能延误治疗
  - ❌ 生活建议可能加重病情或误导患者
  - ❌ 专业性严重不足
  - ❌ 使用不规范或错误的医学术语

**新增评估要点：**

1. **病情匹配度评估**：
   - 建议是否针对具体的检查结果异常
   - 建议是否考虑患者的年龄、基础疾病等因素
   - 建议强度是否与病情严重程度相匹配

2. **就医时间合理性**：
   - 急重症：建议立即就医或24小时内就诊
   - 慢性病：建议合理随访时间（如1-3个月）
   - 特殊情况：根据风险程度给出分级就诊建议

3. **生活建议针对性**：
   - 饮食建议：是否符合疾病饮食原则（如糖尿病低糖、肾病低蛋白）
   - 运动建议：是否考虑当前身体状况和活动能力
   - 生活习惯：是否针对病因给出具体建议

**RAG验证结果示例：**
```markdown
**建议合理性综合评估摘要：**
- RAG验证覆盖率：8/10项建议（80%）
- 一致性：6项完全一致，2项部分偏差，0项明显矛盾
- 病情匹配度：⭐️⭐️⭐️⭐️ (8/10项建议与病情高度匹配)
- 就医时间合理性：⭐️⭐️⭐️ (建议基本合理，但紧急程度略显保守)
- 生活建议针对性：⭐️⭐️⭐️⭐️ (建议具体，考虑患者具体情况)

**关键发现：**
- ✅ "低碘饮食"建议符合《甲状腺疾病诊治指南2023》，与甲状腺结节病情匹配
- ✅ "3个月后复查"建议针对慢性结节，时间合理
- ⚠️ "每日运动30分钟"建议略显笼统，未考虑患者年龄和活动能力
- ✅ "避免熬夜"建议针对内分泌调节，有针对性
- ⚠️ "立即手术"建议过于激进，与良性结节病情不匹配

**特殊规则：**
- 若RAG验证发现严重矛盾（如用药禁忌） → 建议合理性≤0分
- 若建议与病情严重不匹配可能延误治疗 → 建议合理性≤1分
- 若生活建议可能加重病情 → 建议合理性≤1分
- 若RAG调用失败 → 建议合理性评分上限为2分
- 若解读中无任何建议 → 建议合理性评分为0分

**新增检查清单：**
- [ ] 建议是否针对当前检查异常？
- [ ] 就医时间是否适合病情紧急程度？
- [ ] 生活建议是否考虑患者具体情况？
- [ ] 建议强度是否与风险等级匹配？
- [ ] 是否存在过度治疗或治疗不足？
```

**病情匹配度评估示例：**

| 病情场景 | 良好建议 | 不匹配建议 |
|---------|---------|-----------|
| 轻微感冒 | 多休息、补充水分、3天后未好转就医 | 立即住院、使用抗生素 |
| 良性甲状腺结节 | 6-12个月随访、调整饮食 | 立即手术切除 |
| 重度高血压 | 立即就医调整用药、严格低盐饮食 | 多运动、注意休息 |

**就医时间合理性评估示例：**

| 病情紧急程度 | 合理时间 | 不合理时间 |
|------------|---------|-----------|
| 急性胸痛 | 立即就医/120 | 下周门诊 |
| 慢性胃炎 | 1-2周内消化科就诊 | 立即急诊 |
| 癌症筛查异常 | 1个月内专科就诊 | 半年后复查 |

---  

### C类：体验维度（权重25%）

#### 🧠 多轮记忆（权重5%）

**评分依据：** 历史对话的关联和记忆准确性

- **3分（卓越）**：精确记忆前文关键信息，无记忆错误
- **2分（良好）**：基本记忆正确，偶有小瑕疵
- **1分（合格）**：出现记忆错误或语义重复
- **0分（不合格）**：大面积记忆错误，机械性重复前文
- **-1分（较差）**：产生无害幻觉（如虚构不存在的对话内容）
- **-2分（严重）**：产生有害幻觉（如捏造诊断结论）

**注意：** 若无历史对话，此项评分默认2分

#### 📝 可理解性（权重5%）

**评分依据：** 普通患者的理解难度

- **3分（卓越）**：
  - 专业术语配有通俗解释
  - 使用类比/比喻帮助理解
  - 患者可快速把握关键信息
  
- **2分（良好）**：
  - 展示清晰，逻辑连贯
  - 患者可理解但需一定医学常识
  
- **1分（合格）**：
  - 存在部分理解障碍
  - 专业术语过多未解释
  
- **0分（不合格）**：
  - 语病较多，逻辑混乱
  - 患者难以理解

#### ⚡ 简洁性（权重5%）

**评分依据：** 信息密度和表达效率

- **3分（卓越）**：言简意赅，无冗余，信息密度极高
- **2分（良好）**：内容无明显重复，信息密度适当
- **1分（合格）**：存在表意重复或啰嗦
- **0分（不合格）**：大量机械性重复，冗余严重

#### 😊 拟人化（权重5%）

**评分依据：** 情感关怀和表达自然度

- **3分（卓越）**：
  - 照顾患者情绪（如对异常结果先安抚）
  - 表达自然流畅，像医生对话
  - 适度使用鼓励性语言
  
- **2分（良好）**：
  - 表达不机械
  - 礼貌得体，基本自然
  
- **1分（合格）**：
  - 略显机械化
  - 缺乏温度感
  
- **0分（不合格）**：
  - 内容冰冷
  - 表述可能伤害患者感情

---

## 📋 评估报告输出模板

### 🧠 内部思考区（**展示给用户**）

**说明：以下内容是AI的内部分析过程，仅用于确保评估质量，不输出给用户**

```markdown
## 📷 第一步：图像数据提取

**报告基本信息：**
- 报告类型：[超声/CT/血常规/生化等]
- 检查部位：[具体部位]
- 医院诊断意见（原文）：[直接引用]

**关键临床数据：**
1. [指标名]：[数值][单位]（正常：[范围]）[状态：↑/↓/正常]
2. [指标名]：[数值][单位]（正常：[范围]）[状态：↑/↓/正常]

**异常发现：** [列举]

---

## 🔍 第二步：准确性比对（边比对边评估其他维度）

**数值核对：**
- ✅ [指标]：一致
- ❌ [指标]：解读"[X]" vs 图像"[Y]" → 错误

**准确率：** (N-E)/N = [R]% → 准确性评分：[X]分

---

## 📊 第三步：完成9个维度评估

[快速完成其他11个维度的评分推导]
```

**执行要点：**
- 这三步是一个**连贯的内部思考过程**，不需要分段输出
- 完成内部思考后，直接输出用户可见的评估报告
- 不要在用户可见区重复展示数据提取过程

### 💬 用户可见区（正式输出）

````markdown
## 医疗报告解读质量评估报告

### 📊 综合评估

**总体评分：** [加权平均分]/3.0
- A类维度（核心）：[平均分]/3.0
- B类维度（专业）：[平均分]/3.0  
- C类维度（体验）：[平均分]/3.0

**总体评价：** [简明扼要的总结性判断，2-3句话]

---

### 📈 维度评分明细（含评分理由）

#### A类：核心维度

**📊 准确性：[X]分 - [等级]**
**🎯 评分理由：**
- **量化基准：** 基于 [N] 项关键指标的逐项比对
- **准确率：** [M]/[N] = [R]%，其中错误 [E] 项，遗漏 [O] 项
- **关键发现：** [简要描述最重要的错误/遗漏项]

- ✅ **正确项**（[M]项）：
  - [具体指标名]：解读值与图像值一致
  - [具体指标名]：描述准确
  
- ❌ **错误项**（[E]项）：
  - [具体指标名]：解读"[X]" vs 图像"[Y]"，偏差[Z]%
  - [具体描述]：与图像诊断意见矛盾
  
- ⚠️ **遗漏项**（[O]项）：
  - 图像中的"[重要发现]"未在解读中提及

**🤝 相关性：[X]分 - [等级]**
**🎯 评分理由：**
- **用户需求匹配度：** [具体评估说明，如"完全响应主要问题"、"遗漏关键诉求"]
- **主题一致性：** [评估解读与用户提问的相关性]
- [针对性评估说明]

#### B类：专业维度

**⏱️ 时效性：[X]分 - [等级]**
**🎯 评分理由：**
- **信息来源时效性：** [评估使用的医学证据/指南的时效性]
- **临床适用性：** [评估建议在当前临床实践中的适用性]
- [时效性评估说明]

**📚 全面性：[X]分 - [等级]**
**🎯 评分理由：**
- **内容模块完整性：** [已包含模块]/[推荐模块] ([P]%)
- **关键信息覆盖：** [评估是否覆盖关键临床信息]
- 已包含模块：[列举]
- 缺失模块：[列举]

**💼 建议合理性：[X]分 - [等级]**
**🎯 评分理由：**
- **RAG验证结果：** 验证 [V] 项建议，一致性 [C]%，其中：
  - ✅ 一致：[N1] 项
  - ⚠️ 偏差：[N2] 项  
  - ❌ 矛盾：[N3] 项
- **专业规范性：** [评估医学术语使用和专业表达]
- [专业性评估说明]

#### C类：体验维度

**🧠 多轮记忆：[X]分 - [等级]**
**🎯 评分理由：**
- **上下文连贯性：** [评估与前文对话的连接程度]
- **记忆准确性：** [评估历史信息的使用准确性]
- [记忆准确性评估]

**📝 可理解性：[X]分 - [等级]**
**🎯 评分理由：**
- **患者友好度：** [评估普通患者的理解难度]
- **专业术语解释：** [评估医学术语的通俗化程度]
- [理解难度评估]

**⚡ 简洁性：[X]分 - [等级]**
**🎯 评分理由：**
- **信息密度：** [评估内容的冗余程度]
- **表达效率：** [评估表述的简洁有效性]
- [信息密度评估]

**😊 拟人化：[X]分 - [等级]**
**🎯 评分理由：**
- **情感关怀：** [评估对患者情绪的关注程度]
- **沟通亲和力：** [评估表达的自然和温暖程度]
- [情感关怀评估]

---

### 🔍 关键发现

**✅ 主要优势：**
1. [突出的专业优势]
2. [优秀的沟通亮点]

**❌ 待改进项：**
1. [需要重点关注的问题]
2. [影响质量的关键短板]

**📷 图像数据利用情况：**
- 数据提取完整性：[评价]
- 数据应用准确性：[评价]
- 与医院意见一致性：[评价]

---

### 💡 优化建议

**🔴 高优先级（必须改进）：**
1. **[具体问题]** → 建议：[具体改进方案]
   - 现状：[问题描述]
   - 影响：[对患者/诊断的影响]
   - 改进示例：[正确表述]

**🟡 中优先级（建议改进）：**
1. **[具体问题]** → 建议：[优化建议]
   - 优化方向：[说明]

**🟢 低优先级（锦上添花）：**
1. **[细节优化]** → 建议：[完善建议]

---

### 📌 使用说明

本评估基于以下标准：
- 准确性：以报告图像原始数据为唯一依据
- 专业性：参照医学规范和临床实践
- 体验性：兼顾患者理解需求和情感关怀

评分体系：-2（严重问题）至 3（卓越表现），共6个档次
````

---

### 执行检查清单

**在输出评估报告前，确认以下事项：**

- [ ] 已准备evaluation_data字典（包含29个字段）
- [ ] 使用了新字段名：suggestion_quality, memory_retention, personification

---


## 🚨 异常情况处理

### 输入异常

**缺少报告图像：**
```
⚠️ 无法进行评估

**缺少必需输入**：医疗报告图像

请上传医疗报告图片后再进行质量评估。
```

**缺少解读文本：**
```
⚠️ 无法进行评估

**缺少必需输入**：报告解读文本

请提供待评估的解读内容。
```

### 图像质量异常

**图像模糊不可读：**
```
⚠️ 图像质量问题

当前图像过于模糊，无法准确提取关键数据。
请上传更清晰的报告图像，或提供文字版报告内容。
```

**非医疗报告图像：**
```
⚠️ 图像类型不匹配

检测到上传的不是医疗报告图像。
本评估工具仅适用于：检验报告、影像报告、病理报告等医疗文档。
```

### 解读文本异常

**解读文本为空或过短（<50字）：**
```
⚠️ 解读内容不足

当前解读文本过短（少于50字），无法进行有效评估。
请提供完整的医疗报告解读内容。
```

### RAG调用异常

**RAG脚本调用失败：**
```
⚠️ RAG验证部分失败

知识库验证功能暂时不可用，建议合理性评分将基于专业判断。
评估结果仍然有效，但建议手动核查医学建议的权威性。
```

**知识库无相关条目：**
```
ℹ️ RAG验证提示

知识库中未找到部分医学建议的权威依据。
这可能是因为：建议过于新颖、属于罕见病、或表述不够标准。
评分将结合专业判断和常识进行。
```


---

## ✅ 质量保障自检清单

**在输出评估报告前，快速自检以下要点：**

### 输入检查（5秒）
- [ ] 报告图像存在且可读
- [ ] 解读文本存在且充足（≥50字）

### 内部思考完成度（展示给用户）
- [ ] 已提取图像关键数据
- [ ] 已执行RAG知识库验证（或已记录失败原因）
- [ ] 已完成准确性比对
- [ ] 9个维度评分全部完成

### 输出质量（最终呈现）
- [ ] 用户可见区格式符合模板
- [ ] 准确性评分有具体数据支撑
- [ ] 建议合理性评分引用了RAG验证结果
- [ ] 改进建议具体可操作
- [ ] 无主观臆断，一切基于数据

### 数据导出（自动执行）
- [ ] json文件已生成
- [ ] 包含所有评分理由字段（9个维度各一个理由）
- [ ] 文件路径正确（/home/xieshiao/user-data/outputs/）
- [ ] 已使用 present_files 提供下载链接
- [ ] 文件包含完整的评分数据及理由

**⚠️ 执行提醒：**
- 自检过程在内部完成，不要向用户输出"正在检查..."之类的过程说明
- RAG验证自动执行，不要向用户说明"正在调用知识库..."
- json导出自动执行
- 检查完毕后直接输出完整的评估报告

---