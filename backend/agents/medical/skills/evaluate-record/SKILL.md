---
name: evaluate-record
description: 医疗报告解读质量评估工具，依据专业标准对解读内容、报告单图片进行量化评分并提供改进建议，支持RAG知识库验证，提升医疗报告的专业性和患者理解度。当用户有对解读质量进行评价、评分需求时触发。
---

# 医疗报告解读质量评估指南

## 🚀 快速执行指南

**完整评估流程（一次性完成）：**

1. **检查输入** → 缺少报告图像或解读文本时才停止1111111
2. **提取数据** → 在内部思考中读取图像关键信息
3. **RAG验证** → 在内部自动调用医学知识库验证建议合理性（执行规范见下文“评估核心原则”）
4. **比对评分** → 基于数据比对完成9个维度评分
5. **输出报告** → 直接呈现最终评估结果

**⚠️ 重要：**   

- 整个流程应当连贯执行，不要在中间步骤停顿或等待用户反馈
- RAG验证在内部自动完成，无需向用户说明调用过程
- 只有在缺少必需输入时才需要停止


---

## 📋 核心输入要素

| 要素 | 必需性 | 说明 |
|------|--------|------|
| **报告图像（`image`）** | 🔴 必需 | 医疗报告原始图片，评估准确性的唯一依据 |
| **解读文本（`report`）** | 🔴 必需 | 待评估的医疗报告解读内容 |
| **用户提问（`query`）** | ⚠️ 可选 | 影响相关性评分 |
| **历史对话（`history`）** | ⚠️ 可选 | 影响多轮记忆评分 |

---

## ⚠️ 评估执行流程

### 第一步：输入验证（快速检查）

**仅在缺少必需输入时才停止评估：**
- 若缺少报告图像 → 提示用户上传图像
- 若缺少解读文本 → 提示用户提供解读内容
- 若两者都有 → 直接进入第二步，无需额外说明

### 第二步：数据提取（在内部思考中完成）

**在开始评估时，先在内部思考区提取图像数据，格式如下：**

```markdown
## 🧠 内部思考（**需要展示给用户**）

### 📷 图像数据提取记录

**报告基本信息：**
- 报告类型：[超声/CT/血常规/生化等]
- 检查部位：[具体部位]
- 检查日期：[YYYY-MM-DD]
- 医疗机构：[医院名称]

**关键临床数据：**
1. [指标名称]：[数值] [单位]（正常范围：[范围]）[状态：↑/↓/正常]
2. [指标名称]：[数值] [单位]（正常范围：[范围]）[状态：↑/↓/正常]
3. ...

**异常发现：**
- [具体描述异常项目，含位置、大小、性质等]

**医院诊断意见（原文）：**
> [直接引用图像中的诊断结论]

✅ 数据提取完成，共提取 [N] 项关键指标
```

**📌 提取规范：**
- ✅ 必须列出所有数值型指标的具体数据
- ✅ 必须原文引用医院诊断意见
- ❌ 禁止使用"根据图像显示..."等模糊表述  


### 第三步：RAG知识库验证（在内部思考中完成） 

**🔬 建议合理性验证流程：**

当评估**建议合理性**维度时，自动触发RAG验证：

```markdown
### 🔬 RAG知识库验证（内部执行）

**提取待验证内容：**
1. 从解读文本中提取所有医学建议（诊疗建议、用药建议、复查建议）
2. 从解读文本中提取所有生活建议（饮食、运动、作息等）


**执行RAG查询：**
[调用 bash_tool 执行 Python 脚本]
```bash
# 注意：不要写死他人机器路径；在本项目中从后端目录运行用相对路径即可
python agents/medical/skills/evaluate-record/scripts/rag.py \
  --query "[疾病名称]" \
  --source "book"
```

**验证结果分析：**
- ✅ **与权威知识一致** ([M]项)：
  - [建议内容] ← 符合[指南/文献]的推荐
  
- ⚠️ **部分偏差** ([P]项)：
  - [建议内容] ← 与[知识库]存在细微差异
  
- ❌ **明显矛盾** ([C]项)：
  - [建议内容] ← 与[权威来源]的观点相悖
  
- 📝 **缺乏依据** ([U]项)：
  - [建议内容] ← 知识库中未找到支撑证据

**验证覆盖率：** [已验证项]/[总建议数] = [X]%
```  

**🔧 RAG调用规范：**

1. **关键词提取策略**：
   - 提取疾病名称、症状描述、异常指标名
   - 提取解读中的核心医学术语（如"甲状腺结节"、"肝功能异常"）
   - 每次RAG查询使用2-4个关键词组合

2. **验证优先级**：
   - 🔴 **高优先级**：诊疗建议、用药建议、手术建议
   - 🟡 **中优先级**：复查建议、饮食建议
   - 🟢 **低优先级**：一般性生活建议

3. **RAG工具使用**：
```python
# 示例调用（内部执行，不展示给用户）
# 使用 bash_tool 调用 rag.py 脚本
# 返回结果包含：权威来源、一致性评分、引用文献
```

4. **验证失败处理**：
   - 若RAG脚本调用失败 → 建议合理性评分默认降1档
   - 若知识库无相关条目 → 标注为"缺乏依据"但不强制扣分
   - 若存在明显矛盾 → 建议合理性评分≤1分

**⚠️ 关键提醒：**
- RAG验证是**内部自动化流程**，具体过程不需要在面向用户的回答中逐条说明
- 验证结果直接体现在"建议合理性"评分中
- 在最终报告的"建议合理性"部分，引用RAG验证发现的问题



### 第四步：评估打分（基于数据比对）

**在评估每个维度时，同步进行数据比对：**

**对于准确性维度**，必须逐项对照解读文本与图像数据：

```markdown
### 🔍 准确性比对分析

**数值指标核对（共 [N] 项）：**
- ✅ [指标名]：解读"[X]" vs 图像"[Y]" → 一致
- ❌ [指标名]：解读"[X]" vs 图像"[Y]" → 偏差 [Z]%
- ...

**定性描述核对：**
- ✅ 异常发现：描述准确，与图像吻合
- ❌ 诊断倾向：解读"[A]" vs 医院意见"[B]" → 存在矛盾

**关键遗漏检查：**
- 图像中的重要异常"[X]"在解读中未提及

**比对结论：**
- 准确项：[M] 项（占比 [P]%）
- 错误项：[E] 项
- 遗漏项：[O] 项
```

---

## 🎯 评估核心原则

### 0. 🔄 流程连贯性（执行规范）

**评估是一个连贯的过程，不应中断：**

- ✅ **正确执行方式**：内部思考（提取数据 → RAG验证 → 比对分析）→ 直接输出评估报告 → 生成JSON结果
- ❌ **错误执行方式**：提取数据 → 停顿 → 等待指令 → 再评估
- ❌ **错误执行方式**：向用户展示"我已完成数据提取，现在调用RAG..."

**明确：**
- 数据提取、RAG验证、比对分析是**内部思考过程**，不需要向用户汇报进度
- 除非缺少必需输入，否则应一次性完成从数据提取到输出报告的全过程


### 1. 📷 图像数据驱动（最高优先级）

**所有评估必须以报告图像为唯一客观依据**

- 准确性评分：100% 基于图像数据比对结果
- 建议合理性评分：必须结合RAG知识库验证
- 其他维度：在不违背图像事实的前提下评估

**⚠️ 核心规则：凡是与图像数据相矛盾的解读内容，准确性评分≤0分。 凡是与RAG知识库严重矛盾的建议，建议合理性评分≤1分**

### 2. 📊 标准化评分体系

**评分档位：** -2、-1、0、1、2、3（共6档）

**维度分类与权重：**
- **🔴 A类 - 核心诊断维度（权重40%）**：准确性、相关性
  - *评估重点：诊断结果的客观准确性与用户需求的匹配度*
- **🟡 B类 - 专业内容维度（权重35%）**：时效性、全面性、建议合理性  
  - *评估重点：医学内容的专业深度、时效价值和实用指导性*
- **🟢 C类 - 沟通体验维度（权重25%）**：多轮记忆、可理解性、简洁性、拟人化
  - *评估重点：信息传达的有效性和患者体验的优化*

**总体评分计算与映射（用于系统统计与对齐人评）：**
- 先按上述权重对9个维度的原始评分（-2 ~ 3）做加权平均，得到**总体原始评分 `overall_score_raw`**，范围同为 -2 ~ 3；
- 将 `overall_score_raw` 线性映射到 0 ~ 100 分：  
  \[
  overall\_score\_normalized = \frac{overall\_score\_raw + 2}{5} \times 100
  \]
- 对用户展示时可以同时给出：原始评分（-2 ~ 3）与标准化百分制评分（0 ~ 100），便于与医生人评对齐。

**安全封顶规则（A类维度优先）：**
- 若**准确性 ≤ -1** 或 **建议合理性 ≤ 0**，则**总体原始评分上限 ≤ 1 分**；
- 若RAG验证或内容分析发现**严重高危建议**（例如：推荐被明令禁用的药物/手术、明显延误必要救治等），则：
  - 建议合理性维度评分应≤0分；
  - 在综合评估中必须显式提示“存在严重安全隐患”，而不仅仅是分数降低。


### 3. 📋 结构化输出

**输出分为三个区域：**

1. **🧠 内部思考区（展示给用户）**
   - 图像数据提取记录
   - RAG验证结果（仅列关键发现）
   - 数据比对分析
   - 评分依据推导

2. **💬 用户可见区（正式输出）**
   - 综合评估总结
   - 9个维度评分明细
   - 关键发现分析
   - 优化改进建议



---

## 📈 评分标准详解

### A类：核心维度（权重40%）

#### 📊 准确性（权重25%）

**评分依据：** 对解读中所有被提及的指标/结论/建议进行核对，重点检查：数值、单位、参考区间、↑↓/阴阳性、是否“正常/异常”、以及是否出现报告单未包含的内容（事实性幻觉）。
需要特别注意**医学常识层面的张冠李戴**，例如：血常规中`×10^12/L`通常为红细胞计数单位，而血红蛋白（HGB）临床多用`g/L`表示，若解读中互相调换或对应错误，属于明显准确性问题，应被识别并在评语中指出。
**评分映射（兼顾严谨与容错）：**
- **3分（卓越）**：  
  - 所有**核心诊断结论与关键指标**解读完全准确（数值/单位/参考范围/阴阳性/正常或异常与报告单一致）；  
  - 无任何会影响临床决策的错误；  
  - 可允许**极少量不影响理解的文字级瑕疵**（如单次轻微口误，且整体语境已自我纠正），但不得影响对病情轻重、阳性/阴性、是否异常等关键判断；  
  - 对明显的张冠李戴（如单位或项目对错）能明确纠正并说明。
- **2分（良好）**：  
  - **核心诊断方向及主要结论正确**（如疾病性质、严重程度、是否需要立即就医等判断无误）；  
  - 大部分关键指标和文字描述与报告一致，可能存在**少量次要指标数值/单位错误、表述不严谨**或个别未识别的小问题，但**不改变整体诊断结论和就医决策**；  
  - 适用于“主干正确、枝节有瑕疵”的情况，此类情况一般不应被打到1分以下。
- **1分（合格）**：  
  - 主要诊断结论基本正确，但存在**多处细节问题**，或**1-2处与报告不符且可能引起患者明显误解**（如把“轻度异常”描述为“严重异常”，但仍未影响是否需要急诊的判断）；  
  - 需要专业人员进行二次核对和修订后方可用于正式对外传播；  
  - 不适用于仅有少数非关键性的小错误（那应更偏向2分）。
- **0分（不合格）**：  
  - 核心诊断存在明显模糊或偏离，如对主要疾病性质、关键危险信号（如明显贫血、严重肝肾功能异常）判断不清；  
  - 或对报告中的**主要异常指标**理解错误/未识别，影响整体病情判断；  
  - 但尚未构成立即的医疗风险（未直接导向危险行为）。
- **-1分（较差）**：  
  - 存在**明显诊断错误并带来潜在医疗风险**，包括但不限于：  
    - 将急症误判为“观察即可”或“问题不大”；  
    - 在明确禁忌情况下仍建议使用相关药物或高危操作；  
    - 编造报告单中不存在的检查结果（事实性幻觉），可能误导患者就医行为。
- **-2分（严重）**：  
  - 解读内容与图像或报告文字**严重不符**，核心诊断方向完全脱离事实，或者  
  - 出现**高风险错误**，若被患者采纳，可能导致严重伤害或延误救治。

**新增量化检查逻辑（供实现与标注时参考）：**
- 统计所有被解读覆盖的关键指标/结论数量为 `N`，其中：
  - 准确无误的为 `M`；
  - 存在明显错误的为 `E`；
  - 遗漏但在图像/报告中存在的重要项目为 `O`；
- 计算准确率：  
  \[
  accuracy\_rate = \frac{M}{N}
  \]
- 推荐阈值映射（在不与上文描述性标准冲突的前提下优先保证安全性）：  
  - **3分**：`accuracy_rate ≥ 0.95`，且无高风险错误（不会改变诊疗决策）；  
  - **2分**：`0.85 ≤ accuracy_rate < 0.95`，且无高风险错误；  
  - **1分**：`0.70 ≤ accuracy_rate < 0.85`，或虽准确率较高但存在1–2处可能引起明显误解但未直接导致危险行为的错误；  
  - **0分**：`accuracy_rate < 0.70`，或对关键异常指标的理解明显错误但暂未导致高危行为建议；  
  - **≤ -1分**：出现严重误导就医行为或高风险错误（如误导延误急诊、错误用药等），优先按安全规则直接降为 -1 或 -2 分。
  
**新增检查清单（需逐项核查）：**
- [ ] 凡在解读中提到的指标，都应能在报告单中找到对应项目，并核对“结果-单位-参考范围-判定(正常/↑/↓)”。
- [ ] 不得把“正常说成升高/降低”，也不得把“升高/降低说成正常”。
- [ ] 不得新增报告单未出现的指标结果、数值、阳性/阴性、或“轻度升高/降低”等未被报告支持的判断。
- [ ] 针对**单位和项目对应关系**进行逻辑核查：  
      - 如血常规中`HGB`常用`g/L`，`RBC`常用`×10^12/L`，若解读中互换，应判定为明显错误并在评语中指出；  
      - 对类似“计数单位 vs 浓度单位”的张冠李戴，必须识别并计入错误项。
- [ ] 若存在疑似OCR识别错误（如单个数字模糊），应结合上下文和正常参考范围做**医学合理性校验**，避免直接照搬错误结果。

#### 🤝 相关性（权重15%）

**评分依据：** 解读内容与用户提问及当前报告单核心问题的匹配度，既要避免“答非所问”，也要鼓励**在核心问题基础上的适度延展和解释**。


-- **3分（卓越）**：  
  - 紧紧围绕用户最关心的问题（如“我这个指标严重吗？”、“要不要住院？”）展开；  
  - 对报告中的主要异常逐一解释，并结合用户问题给出清晰结论；  
  - 可包含适量相关背景知识科普，但不会喧宾夺主。
- **2分（良好）**：  
  - 基本满足用户需求，核心问题得到明确回应；  
  - 存在部分与问题关联不强的补充内容（如一般性科普、与本次检查关系不大的扩展说明），但**不影响用户获取关键信息**；  
  - 适用于“方向正确但略有跑题”的情况，一般不应因少量扩展内容而过度扣分。
- **1分（合格）**：  
  - 仅回答了问题的一部分，或对报告中的主要关注点着墨不够；  
  - 存在明显“重点偏移”，例如过多展开与本次检查关系不大的疾病史、远离当前报告的内容；  
  - 用户需要额外提问才能获得完整答案。
- **0分（不合格）**：  
  - 明显答非所问，或完全忽略用户最关心的问题；  
  - 解读内容与本次报告的主要异常关联度极低。

**注意：** - 若无用户提问，仅基于报告图像进行解读，相关性评分默认**2分**，在此基础上根据是否围绕报告核心问题进行适度上下调。  
- 当模型给出大量补充性、但与病情相关的解释时，不应仅因“信息较多”就降低相关性评分，而应看其是否仍围绕报告与患者当前状况展开。
---

### B类：专业维度（权重35%）

#### ⏱️ 时效性（权重10%）

**评分依据：** 医疗信息的时效性和当前临床适用性，重点关注是否仍符合**当下主流指南/共识**，而非机械追求“最新年份”。

- **3分（卓越）**：  
  - 明确引用或隐含遵循近年权威指南/共识，推荐方案与当前临床实践完全一致；  
  - 不出现已被广泛淘汰或被证实有害的做法。
- **2分（良好）**：  
  - 信息整体符合当下常规诊疗思路，即使未引用最新年份指南，方案仍然**安全、合理、可执行**；  
  - 可能存在个别略保守或略过时的表述，但**不影响临床安全性**。
- **1分（合格）**：  
  - 部分建议略显过时或不够优化，例如仍沿用旧版随访间隔、检查频率，但整体方向尚可；  
  - 不构成明显风险，仅在“是否最优”上有改进空间。
- **0分（不合格）**：  
  - 采用已经被主流指南明确不推荐、或被证实存在明显风险的方案；  
  - 时效性问题可能导致延误治疗或增加不必要风险。

#### 📚 全面性（权重10%）

**评分依据：** 解读内容的**完整性、深度和结构化程度**，是否能帮助患者对本次检查形成“从检查方法到结果含义再到后续安排”的完整理解。

- **3分（卓越）**：  
  - 至少涵盖以下大部分模块：  
    - 检查目的与**检查方法/技术手段**（如超声、CT、血清学、电化学发光等）；  
    - 关键指标/影像所见及其**临床意义**；  
    - 可能的疾病解释或鉴别诊断思路；  
    - 风险提示（如需警惕的红旗信号）；  
    - 具体可执行的生活/随访/就医建议；  
  - 结构清晰，有条理地从“是什么 → 严重程度 → 需要做什么”进行解释；  
  - 内容既有宽度又有深度，避免只停留在“正常/不正常”的简单判断。
- **2分（良好）**：  
  - 覆盖至少3个以上核心模块（如“检查结果 + 临床意义 + 就医/复查建议”）；  
  - 对检验/检查方法、样本类型、检查时间等**至少提及其一**，即便未完整展开；  
  - 整体信息较丰富，但在个别方面（如风险提示或随访方案）略显简略。
- **1分（合格）**：  
  - 仅包含2个主要模块（如只说明结果+简单建议），缺乏对病因、风险或检查方法的说明；  
  - 解读偏“点状”，没有帮助患者建立完整认知；  
  - 适用于“信息有用但明显不够全面”的情况。
- **0分（不合格）**：  
  - 几乎只罗列检查结果或结论，缺乏任何解释；  
  - 对明显重要的信息（如重度异常的临床意义、需立即就医的提示）完全未涉及。

**建议在合适场景下补充：**
- 检验/影像的**方法学信息**（如是快速筛查还是金标准检测）；  
- 标本类型、采样时间对结果的潜在影响（如空腹/非空腹、晨尿/随机尿等），有助于提升解读的专业完整性。


#### 💼 建议合理性（权重15%）

**⚠️ 关键维度：必须结合RAG知识库验证+临床实用性评估，既要防止明显不当建议，又要避免对轻微措辞或个体化差异过于苛责。**

**评分依据：** 医学建议和生活建议的专业性、权威性、合理性、针对性和可操作性。

**评分流程：**
1. 提取解读中的所有建议（医学建议 + 生活建议）
2. 调用RAG知识库进行自动验证（内部执行）
3. 评估建议与当前病情的匹配度
4. 评估就医时间的合理性
5. 评估生活建议的针对性
6. 综合评分

**评分标准（重点避免“过严”）：**


- **3分（卓越）**：  
  - ✅ RAG验证：所有关键建议与权威知识库高度一致，无明显矛盾；  
  - ✅ 建议与当前病情高度匹配，能够根据异常程度区分轻重缓急；  
  - ✅ 就医时间及复查间隔安排合理，符合常规临床路径；  
  - ✅ 生活及行为建议**具体、可操作且与病情紧密相关**；  
  - ✅ 专业术语使用规范，可适当兼顾通俗表达。
- **2分（良好）**：  
  - ✅ 绝大多数重要建议与知识库一致，仅在**次要建议或表述方式上存在轻微偏差**；  
  - ✅ 整体方向正确，不存在明显危险或误导；  
  - ✅ 就医时间建议基本合理，可能略偏保守或略偏积极；  
  - ✅ 生活建议有一定针对性，即使部分内容较为通用；  
  - ⚠️ 适用于“整体安全可靠，但可以更精细化”的情况，一般不应因个别轻微偏差直接降到1分。
- **1分（合格）**：  
  - ⚠️ RAG验证提示部分建议缺乏明确依据，或与知识库存在一定差异；  
  - ⚠️ 建议强度与病情严重程度不完全匹配（略过度或略不足），但**不至于造成明显延误或过度医疗**；  
  - ⚠️ 就医时间/复查安排不够具体或略显模糊，如仅说“有不适及时就医”而未结合当前风险分级；  
  - ⚠️ 生活建议较为笼统（如“大量饮水、多运动”），缺乏针对具体疾病的个性化调整；  
  - ⚠️ 专业表达略显外行或有个别用词不够严谨，但**核心方向仍然正确**。
- **0分（不合格）**：  
  - ❌ RAG验证发现与权威知识库存在**明显矛盾且涉及诊疗决策**，如推荐被明令禁用的药物或手术；  
  - ❌ 建议与病情严重不匹配，可能导致**延误必要治疗**（例如对高危异常仅建议“观察即可”）；  
  - ❌ 生活/饮食/运动建议明显不适合当前疾病（如肾功能明显受损却建议高蛋白饮食）；  
  - ❌ 专业性严重不足，用词混乱，患者若遵从可能造成实际风险。
**新增评估要点：**

1. **病情匹配度评估**：
   - 建议是否明确针对本次检查发现的异常指标或影像所见；  
   - 是否考虑患者的年龄、基础疾病等常见影响因素（如老年高血压、妊娠、糖尿病等背景）；  
   - 建议强度是否与病情严重程度大致相符，避免对轻度异常给出过于激烈的干预。

2. **就医时间合理性**：
   -- 急重症：应建议立即或尽快就医（如胸痛伴心电图明显异常、重度贫血等）；  
   - 慢性病或稳定情况：可建议在1-3个月内门诊复查或专科随访；  
   - 对不明确风险的情况，可以采用“如出现以下症状需立即就医”的分级策略。
   
3. **生活建议针对性与可执行性**：
   - 饮食建议是否符合疾病特点（如糖尿病建议控制总碳水、肾病注意蛋白及钠摄入等）；  
   - 运动建议是否考虑当前体力状况，避免“一刀切”的高强度要求；  
   - 生活习惯建议是否与潜在病因相关（如熬夜、吸烟、饮酒等）。

**RAG验证结果示例（保持原有逻辑，略作宽容提醒）：**
```markdown
**建议合理性综合评估摘要：**
- RAG验证覆盖率：8/10项建议（80%）
- 一致性：6项完全一致，2项部分偏差，0项明显矛盾
- 病情匹配度：⭐️⭐️⭐️⭐️ (8/10项建议与病情高度匹配)
- 就医时间合理性：⭐️⭐️⭐️ (建议基本合理，但紧急程度略显保守)
- 生活建议针对性：⭐️⭐️⭐️⭐️ (建议具体，考虑患者具体情况)


**特殊规则：**
- 若RAG验证发现**严重矛盾或重要禁忌问题** → 建议合理性评分应≤0分；  
- 若建议方向总体正确，仅在**措辞或个体差异**上与知识库存在偏差，不必过度降分，可维持在1-2分区间；  
- 若RAG调用失败 → 建议合理性评分上限建议为2分，但不自动视为不合格；  
- 若解读中完全无任何建议，可视任务目标为“纯解释报告”，此时建议合理性可酌情给0分并在报告中说明原因。


**新增检查清单：**
- [ ] 建议是否针对当前检查异常？
- [ ] 就医时间是否适合病情紧急程度？
- [ ] 生活建议是否考虑患者具体情况？
- [ ] 建议强度是否与风险等级匹配？
- [ ] 是否存在过度治疗或治疗不足？
```

**病情匹配度与就医时间示例：**

| 病情场景 | 良好建议 | 不匹配建议 |
|---------|---------|-----------|
| 轻微感冒 | 多休息、补充水分、3天后未好转就医 | 立即住院、使用抗生素 |
| 良性甲状腺结节 | 6-12个月随访、调整饮食 | 立即手术切除 |
| 重度高血压 | 立即就医调整用药、严格低盐饮食 | 多运动、注意休息 |


---  

### C类：体验维度（权重25%）

#### 🧠 多轮记忆（权重5%）

**评分依据：** 对历史对话中**医学关键信息**的记忆与延续性，鼓励在多轮问答中保持病情判断的一致和连贯。

- **3分（卓越）**：  
  - 准确记忆并正确引用前文中的关键诊断、指标、既往病史等信息；  
  - 不出现与前文相矛盾的说法；  
  - 能在新问题中自然承接之前的解释。
- **2分（良好）**：  
  - 总体记忆正确，个别非关键细节（如具体措辞、一些生活细节）遗忘或略有偏差；  
  - 不影响对病情和建议的核心判断。
- **1分（合格）**：  
  - 出现少量与前文不一致的表述，或重复解释而缺乏整合；  
  - 对关键医学信息仍大体保持一致。
- **0分（不合格）**：  
  - 对前文核心医学信息（如诊断名称、严重程度）出现明显矛盾或遗忘，影响整体理解；  
  - 大面积机械性重复前文内容而未根据新问题调整。
- **-1分（较差）**：  
  - 虽未造成直接医疗风险，但对既往信息的虚构或误引较多，削弱信任度。
- **-2分（严重）**：  
  - 因记忆错误直接导致医学结论发生危险性改变。
**注意：** 若无历史对话，此项评分默认**2分**，不鼓励因“缺少场景”而过度扣分。

#### 📝 可理解性（权重5%）

**评分依据：** 普通患者的理解难度，特别关注是否有**通俗解释和层次化表达**，而不是仅堆砌专业名词。

- **3分（卓越）**：  
  - 关键医学术语均配有通俗易懂的解释，或用形象比喻帮助理解（如“轻度升高，好比体温略微比正常高一点”）；  
  - 结构清晰，分段合理，患者可以顺着“检查结果 → 含义 → 需要做什么”这一主线快速抓住重点。
- **2分（良好）**：  
  - 语句清楚、逻辑连贯，整体易读；  
  - 存在部分未解释的专业术语，但不影响整体理解；  
  - 适合有一定医学常识的普通人。
- **1分（合格）**：  
  - 专业术语较多且未做解释，普通患者阅读时需要多次反复；  
  - 整体逻辑尚可，但语言偏“报告体”，缺乏面向患者的转译。
- **0分（不合格）**：  
  - 语病明显、逻辑混乱，关键结论难以理解；  
  - 可能让患者产生严重误解或误读病情。


#### ⚡ 简洁性（权重5%）

**评分依据：** 信息密度和表达效率，要求“**在保证充分解释的前提下尽量避免无效重复**”，避免因追求简短而牺牲必要说明。

- **3分（卓越）**：  
  - 层次清晰、段落适中，无明显无信息增量的重复；  
  - 重点突出，能在有限篇幅内讲清楚病情、风险及下一步建议。
- **2分（良好）**：  
  - 偶有重复强调，但有助于患者记住要点；  
  - 整体篇幅适中，不让人有“读不完”的负担。
- **1分（合格）**：  
  - 存在明显啰嗦或结构松散，如同一结论在多个位置反复出现；  
  - 但仍能提供有价值信息。
- **0分（不合格）**：  
  - 大量机械堆叠相同内容，或长篇输出却缺乏实质信息，严重影响阅读体验。

#### 😊 拟人化（权重5%）

**评分依据：** 情感关怀、共情程度和表达自然度，鼓励“像一位负责任的医生在跟患者说话”，又避免过度情绪化或不实承诺。
- **3分（卓越）**：  
  - 在说明异常时，先对患者情绪进行适度安抚（如“先不用过度担心，我们一点点看清楚”）；  
  - 用语自然温和，具有人情味，既不冷冰冰也不过度夸大；  
  - 能根据病情轻重给出适度的鼓励和现实期望（如“多配合治疗，很多人都可以稳定控制住”）。
- **2分（良好）**：  
  - 语言不机械，常用礼貌表达（如“建议您”“辛苦您”）；  
  - 整体语气友好、尊重患者，即便情感表达不算丰富；  
  - 不出现冒犯或冷漠的措辞。
- **1分（合格）**：  
  - 表达偏中性、偏“机器化”，几乎不体现情绪关怀；  
  - 但不带有负面情绪或伤害性语言。
- **0分（不合格）**：  
  - 用词生硬甚至可能伤害患者感情（如“问题很严重，你自己之前没注意”）；  
  - 对患者焦虑或担忧缺乏基本尊重和理解。

---

## 📋 评估报告输出模板

### 🧠 内部思考区（**展示给用户**）


```markdown
## 📷 第一步：图像数据提取

**报告基本信息：**
- 报告类型：[超声/CT/血常规/生化等]
- 检查部位：[具体部位]
- 医院诊断意见（原文）：[直接引用]

**关键临床数据：**
1. [指标名]：[数值][单位]（正常：[范围]）[状态：↑/↓/正常]
2. [指标名]：[数值][单位]（正常：[范围]）[状态：↑/↓/正常]

**异常发现：** [列举]

---

## 🔍 第二步：准确性比对（边比对边评估其他维度）

**数值核对：**
- ✅ [指标]：一致
- ❌ [指标]：解读"[X]" vs 图像"[Y]" → 错误

**准确率：** (N-E)/N = [R]% → 准确性评分：[X]分

---

## 📊 第三步：完成9个维度评估

[快速完成其余维度的评分推导]
```

**执行要点：**
- 这三步是一个**连贯的内部思考过程**，不需要分段输出
- 完成内部思考后，直接输出用户可见的评估报告
- 不要在用户可见区重复展示数据提取过程

### 💬 用户可见区（正式输出）

````markdown
## 医疗报告解读质量评估报告

### 📊 综合评估

**总体评分：** 原始加权平均 [overall_score_raw]（范围 -2.0 ~ 3.0），标准化评分 [overall_score_normalized]/100
- A类维度（核心）：[平均分]/3.0
- B类维度（专业）：[平均分]/3.0  
- C类维度（体验）：[平均分]/3.0

**总体评价：** [简明扼要的总结性判断，2-3句话]

---

### 📈 维度评分明细（含评分理由）

#### A类：核心维度

**📊 准确性：[X]分 - [等级]**
**🎯 评分理由：**
- **量化基准：** 基于 [N] 项关键指标的逐项比对
- **准确率：** [M]/[N] = [R]%，其中错误 [E] 项，遗漏 [O] 项
- **关键发现：** [简要描述最重要的错误/遗漏项]

- ✅ **正确项**（[M]项）：
  - [具体指标名]：解读值与图像值一致
  - [具体指标名]：描述准确
  
- ❌ **错误项**（[E]项）：
  - [具体指标名]：解读"[X]" vs 图像"[Y]"，偏差[Z]%
  - [具体描述]：与图像诊断意见矛盾
  
- ⚠️ **遗漏项**（[O]项）：
  - 图像中的"[重要发现]"未在解读中提及

**🤝 相关性：[X]分 - [等级]**
**🎯 评分理由：**
- **用户需求匹配度：** [具体评估说明，如"完全响应主要问题"、"遗漏关键诉求"]
- **主题一致性：** [评估解读与用户提问的相关性]
- [针对性评估说明]

#### B类：专业维度

**⏱️ 时效性：[X]分 - [等级]**
**🎯 评分理由：**
- **信息来源时效性：** [评估使用的医学证据/指南的时效性]
- **临床适用性：** [评估建议在当前临床实践中的适用性]
- [时效性评估说明]

**📚 全面性：[X]分 - [等级]**
**🎯 评分理由：**
- **内容模块完整性：** [已包含模块]/[推荐模块] ([P]%)
- **关键信息覆盖：** [评估是否覆盖关键临床信息]
- 已包含模块：[列举]
- 缺失模块：[列举]

**💼 建议合理性：[X]分 - [等级]**
**🎯 评分理由：**
- **RAG验证结果：** 验证 [V] 项建议，一致性 [C]%，其中：
  - ✅ 一致：[N1] 项
  - ⚠️ 偏差：[N2] 项  
  - ❌ 矛盾：[N3] 项
- **专业规范性：** [评估医学术语使用和专业表达]
- [专业性评估说明]

#### C类：体验维度

**🧠 多轮记忆：[X]分 - [等级]**
**🎯 评分理由：**
- **上下文连贯性：** [评估与前文对话的连接程度]
- **记忆准确性：** [评估历史信息的使用准确性]
- [记忆准确性评估]

**📝 可理解性：[X]分 - [等级]**
**🎯 评分理由：**
- **患者友好度：** [评估普通患者的理解难度]
- **专业术语解释：** [评估医学术语的通俗化程度]
- [理解难度评估]

**⚡ 简洁性：[X]分 - [等级]**
**🎯 评分理由：**
- **信息密度：** [评估内容的冗余程度]
- **表达效率：** [评估表述的简洁有效性]
- [信息密度评估]

**😊 拟人化：[X]分 - [等级]**
**🎯 评分理由：**
- **情感关怀：** [评估对患者情绪的关注程度]
- **沟通亲和力：** [评估表达的自然和温暖程度]
- [情感关怀评估]

---

### 🔍 关键发现

**✅ 主要优势：**
1. [突出的专业优势]
2. [优秀的沟通亮点]

**❌ 待改进项：**
1. [需要重点关注的问题]
2. [影响质量的关键短板]

**📷 图像数据利用情况：**
- 数据提取完整性：[评价]
- 数据应用准确性：[评价]
- 与医院意见一致性：[评价]

---

### 💡 优化建议

**🔴 高优先级（必须改进）：**
1. **[具体问题]** → 建议：[具体改进方案]
   - 现状：[问题描述]
   - 影响：[对患者/诊断的影响]
   - 改进示例：[正确表述]

**🟡 中优先级（建议改进）：**
1. **[具体问题]** → 建议：[优化建议]
   - 优化方向：[说明]

**🟢 低优先级（锦上添花）：**
1. **[细节优化]** → 建议：[完善建议]

---

### 📌 使用说明

本评估基于以下标准：
- 准确性：以报告图像原始数据为唯一依据
- 专业性：参照医学规范和临床实践
- 体验性：兼顾患者理解需求和情感关怀

评分体系：-2（严重问题）至 3（卓越表现），共6个档次
````

---


## 🚨 异常情况处理

### 输入异常

- **缺少报告图像：**
  - 明确告知“缺少必需输入：医疗报告图像，当前无法进行评估”；  
  - 引导用户上传清晰的医疗报告图片；  
  - **不得输出任何维度评分或总体评分**。

- **缺少解读文本：**
  - 明确告知“缺少必需输入：报告解读文本，当前无法进行评估”；  
  - 引导用户提供完整的待评估解读内容；  
  - **不得输出任何维度评分或总体评分**。

### 图像质量异常

- **图像模糊不可读：**
  - 提示“图像过于模糊，无法准确提取关键数据”；  
  - 建议上传更清晰的报告图像或提供文字版报告；  
  - 若无法得到可用数据，同样**不要给出评分**。

- **非医疗报告图像：**
  - 说明“检测到上传图像不是医疗报告文档”；  
  - 列出本工具支持的文档类型（如检验报告、影像报告、病理报告等）；  
  - 提示用户重新上传符合要求的报告图像。

### 解读文本异常

- **解读文本为空或过短（<50字）：**
  - 说明“解读内容不足，当前无法进行有效评估”；  
  - 建议用户提供不少于50字的完整报告解读；  
  - 避免在缺乏足够信息的前提下给出主观评分。


### RAG调用异常

- **RAG脚本调用失败：**
  - 内部记录“RAG验证部分失败，改由专业规则与常识进行判断”；  
  - 对用户可提示“知识库验证功能暂时不可用，建议合理性评分基于专业判断”；  
  - 在评分上：**建议合理性维度上限为2分**，其余维度不受影响。

- **知识库无相关条目：**
  - 内部标注“知识库中未找到部分建议的权威依据，可能因建议较新或疾病较罕见等原因”；  
  - 不强制扣分，由临床合理性与安全性综合决定；  
  - 面向用户时可简单解释为“部分建议缺乏充分文献支持，建议结合医生面诊综合判断”。


---

## ✅ 质量保障自检清单

**在输出评估报告前，快速自检以下要点：**

### 输入检查（5秒）
- [ ] 报告图像存在且可读
- [ ] 解读文本存在且充足（≥50字）

### 内部思考完成度
- [ ] 已提取图像关键数据
- [ ] 已执行RAG知识库验证（或已记录失败原因）
- [ ] 已完成准确性比对
- [ ] 9个维度评分全部完成

### 输出质量（最终呈现）
- [ ] 用户可见区格式符合模板
- [ ] 准确性评分有具体数据支撑（含至少 N、M、E、O 的说明）
- [ ] 建议合理性评分引用了RAG验证结果或临床合理性分析
- [ ] 改进建议具体可操作
- [ ] 无主观臆断，一切基于数据与专业规范

### 数据导出（自动执行）
- [ ] 包含所有评分理由字段（9个维度各一个理由）
- - 评估报告格式格式参考
  | 维度              | 评分 |
| 准确性             | 2  |
| 相关性             | 2  |
| 时效性             | 2  |
| 全面性             | 2  |
| 建议合理性（含 RAG 验证） | 2  |
| 多轮记忆            | 2  |
| 可理解性            | 2  |
| 简洁性             | 1  |
| 拟人化             | 1  |

**⚠️ 执行提醒：**
- 自检过程在内部完成，不要向用户输出"正在检查..."之类的过程说明
- RAG验证自动执行，不要向用户说明"正在调用知识库..."
- 检查完毕后直接输出完整的评估报告

---